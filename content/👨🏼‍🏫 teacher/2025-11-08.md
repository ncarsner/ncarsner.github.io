title: What's the most complex formula you've ever written?
date: 2025-11-08
author: Nicholas Carsner
category: Teacher
tags: war-stories
slug: war-stories-part-i

# War Stories, part I

Three or four years ago, I interviewed for a position with the Tennessee Mental Health and Substance Abuse Services for an analyst position. Part of the interview would include preparing an Excel dashboard based on published public data and creating visualizations and metrics for presentation during the first half of the interview. This was to demonstrate aptitude using Microsoft Excel, which would be a key component of the job duties. Combined with a dependency on SQL Server, with which I had already spent several years designing and deploying integrated reports, I felt very confident in my ability to satisfy the job requirements. 

I spent roughly an hour a night for a week and a half leading up to my interview. It included several graphs with interactive slicers, lots of error handling, and documentation about the process including declared assumptions because I knew nothing of the domain data, only the tendencies and correlations of the data itself.

Presenting the analysis dashboard included demonstrating how the results logic was expressed and validated, presenting clear and concise conclusions, incuding exclusions where anonymalies existed, and demonstrating how to read and drill down into the charts with slicers, and modifying variables where present.

After the presentation concluded, the panel questions began. I was asked twenty or so questions about receiving feedback, dealing with difficult situations, communicating with coworkers, clients, etc. Approaching the one-hour mark of the interview, there was obvious and mutual rapport, but no party lasts forever. I was keen to wrap up the interview on a high note before some errant question soured the mood.

One question that remained with me was:

<blockquote><i>
What is the most complex Excel formula you've written?
</blockquote></i>

Complexity, in and of itself, is not an aspiration in technology. [PEP 20](https://peps.python.org/pep-0020/) taught us that. Necessity is the mother of invention.

```python
simple > complex > complicated
```

Even though I have a lengthy list of custom formulas I've created over 10+ years, they were written for several functions that now come prepackaged in Office 365:

- creating dynamic arrays <i>(before dynamic arrays existed natively)</i>,
- extracting strings <i>(before textsplit, textbefore, and textafter existed)</i>
- finding conditional minimum or maximum values within ranges <i>(before MINIFS and MAXIFS functions existed)</i>
- returning a dynamic array given a fixed reference point <i>(before # allowed a dynamic array to be detected automatically)</i>
<br><br>

To answer the question, there are two complex formulas that I've written.
<ol>
<li>A formula that converted numbers into their text equivalent.

```excel
=CHOOSE(LEFT(TEXT(B3,"000000000.00"))+1,,"One","Two","Three","Four","Five","Six","Seven","Eight","Nine")
&IF(--LEFT(TEXT(B3,"000000000.00"))=0,,IF(AND(--MID(TEXT(B3,"000000000.00"),2,1)=0,--MID(TEXT(B3,"000000000.00"),3,1)=0)," Hundred"," Hundred and "))
&CHOOSE(MID(TEXT(B3,"000000000.00"),2,1)+1,,,"Twenty ","Thirty ","Forty ","Fifty ","Sixty ","Seventy ","Eighty ","Ninety ")
&IF(--MID(TEXT(B3,"000000000.00"),2,1)<>1,CHOOSE(MID(TEXT(B3,"000000000.00"),3,1)+1,,"One","Two","Three","Four","Five","Six","Seven","Eight","Nine"),
CHOOSE(MID(TEXT(B3,"000000000.00"),3,1)+1,"Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"))
&IF((--LEFT(TEXT(B3,"000000000.00"))+MID(TEXT(B3,"000000000.00"),2,1)+MID(TEXT(B3,"000000000.00"),3,1))=0,,IF(AND((--MID(TEXT(B3,"000000000.00"),4,1)+MID(TEXT(B3,"000000000.00"),5,1)+MID(TEXT(B3,"000000000.00"),6,1)+MID(TEXT(B3,"000000000.00"),7,1))=0,(--MID(TEXT(B3,"000000000.00"),8,1)+RIGHT(TEXT(B3,"000000000.00")))>0)," Million and "," Million "))
&CHOOSE(MID(TEXT(B3,"000000000.00"),4,1)+1,,"One","Two","Three","Four","Five","Six","Seven","Eight","Nine")
&IF(--MID(TEXT(B3,"000000000.00"),4,1)=0,,IF(AND(--MID(TEXT(B3,"000000000.00"),5,1)=0,--MID(TEXT(B3,"000000000.00"),6,1)=0)," Hundred"," Hundred and"))
&CHOOSE(MID(TEXT(B3,"000000000.00"),5,1)+1,,," Twenty"," Thirty"," Forty"," Fifty"," Sixty"," Seventy"," Eighty"," Ninety")
&IF(--MID(TEXT(B3,"000000000.00"),5,1)<>1,CHOOSE(MID(TEXT(B3,"000000000.00"),6,1)+1,," One"," Two"," Three"," Four"," Five"," Six"," Seven"," Eight"," Nine"),CHOOSE(MID(TEXT(B3,"000000000.00"),6,1)+1," Ten"," Eleven"," Twelve"," Thirteen"," Fourteen"," Fifteen"," Sixteen"," Seventeen"," Eighteen"," Nineteen"))
&IF((--MID(TEXT(B3,"000000000.00"),4,1)+MID(TEXT(B3,"000000000.00"),5,1)+MID(TEXT(B3,"000000000.00"),6,1))=0,,IF(OR((--MID(TEXT(B3,"000000000.00"),7,1)+MID(TEXT(B3,"000000000.00"),8,1)+MID(TEXT(B3,"000000000.00"),9,1))=0,--MID(TEXT(B3,"000000000.00"),7,1)<>0)," Thousand "," Thousand and "))
&CHOOSE(MID(TEXT(B3,"000000000.00"),7,1)+1,,"One","Two","Three","Four","Five","Six","Seven","Eight","Nine")
&IF(--MID(TEXT(B3,"000000000.00"),7,1)=0,,IF(AND(--MID(TEXT(B3,"000000000.00"),8,1)=0,--MID(TEXT(B3,"000000000.00"),9,1)=0)," Hundred "," Hundred and "))&
CHOOSE(MID(TEXT(B3,"000000000.00"),8,1)+1,,,"Twenty ","Thirty ","Forty ","Fifty ","Sixty ","Seventy ","Eighty ","Ninety ")
&IF(--MID(TEXT(B3,"000000000.00"),8,1)<>1,CHOOSE(MID(TEXT(B3,"000000000.00"),9,1)+1,,"One","Two","Three","Four","Five","Six","Seven","Eight","Nine"),CHOOSE(MID(TEXT(B3,"000000000.00"),9,1)+1,"Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"))
&" Euro & "&RIGHT(TEXT(B3,"000000000.00"),2)&"/100"
```
<li>Return a random value from a dynamic length list of items

```excel
=INDEX(OFFSET(A1,,,COUNTA(A:A)-1,1),RANDBETWEEN(1,COUNTA(OFFSET(A1,,,COUNTA(A:A)-1,1))))
```
</ol>

<i>Explain the first one. Where did you apply it?</i>
- I never used this pragmatically. I just wanted to see if it could be done.
<br><br>

<i>What about the second one? Was this actually used?</i>
- Yes, this formula was used quite often when compiling text content for proprietary software applications. I would create CSV files with various criteria to trigger expected Pass/Fail conditions on ingestion. This formula allowed me to list any number of items starting in the reference range <i>(A1, in this case)</i> and append supplemental values as needed, like incorrect data types, invalid dates, spaces, malformed data, expressions, and other content that could extend testing of edge cases concurrently with validation. Because the file ingestion was text-based CSVs, I could leverage a large volume of content against a very small footprint in terms of file size.
<br><br>

On the other side, I could some of the same source material to validate the output, and this process was then scalable to the next platform, as long as the same ingestion mechanism was in place.

Complexity can be fun, but predictability is what we're really looking for.